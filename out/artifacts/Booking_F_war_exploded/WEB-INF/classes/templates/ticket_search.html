<!DOCTYPE html>
<html lang="en"
      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

  <title>æœºç¥¨ä¿¡æ¯</title>

  <!-- Google font -->
  <link href="https://fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet">

  <!-- Bootstrap -->
  <link type="text/css" rel="stylesheet" href="css/bootstrap.min.css"/>

  <!-- Custom stlylesheet -->
  <link type="text/css" rel="stylesheet" href="css/normal_style.css"/>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <!-- å¼•å…¥æ ·å¼ -->
  <link rel="stylesheet" href="plugins/elementui/index.css">
  <link rel="stylesheet" href="plugins/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="css/style.css">

</head>

<body>
<div id="app">
  <div id="booking" class="section">
    <div class="header">
      <div class="top-bar">
        <img class="logo" src="/images/logo_201810new.png" alt="logo">
        <ul>
          <li>
            <img src="/images/top_1.png" id="cn_flag">
            <span>å®˜æ–¹ç½‘ç«™</span>
            <span id="separator">|</span>
          </li>
          <li>
            <span>å®¢æœçƒ­çº¿ï¼š95361</span>
            <span id="separator">|</span>
          </li>
          <li shiro:notAuthenticated>
            <a id="login_a" href="/toLogin">
              <img src="https://www.shenzhenair.com/szair_B2C/static/ued/images/header/user.png">ç™»å½•</a>
            <span id="separator">|</span>
          </li>
          <li>
            <a id="register_a" href="/toRegister">
              <img src="https://www.shenzhenair.com/szair_B2C/static/ued/images/header/sign.png">æ³¨å†Œ</a>
          </li>
        </ul>
      </div>

      <el-menu :default-active="activeIndex" class="el-menu-header" mode="horizontal"
               @select="handleSelect" background-color="#fff">
        <el-menu-item style="float: right" index="5" shiro:authenticated> é€€å‡º</el-menu-item>
        <el-menu-item style="float: right" index="4"> æˆ‘çš„è®¢å•</el-menu-item>
        <el-menu-item style="float: right" index="3"> æœºç¥¨é¢„å®š</el-menu-item>
        <el-menu-item style="float: right" index="2"> é¦–é¡µ</el-menu-item>
        <el-menu-item style="float: right" index="1"> æ¬¢è¿æ‚¨ <span shiro:principal></span></el-menu-item>
      </el-menu>
    </div>

    <!--    main stuff starts here-->
    <div class="step_bar">
      <el-steps :active="activeStep" align-center>
        <el-step title="æœºç¥¨æŸ¥è¯¢"></el-step>
        <el-step title="ç¡®è®¤èˆªç­"></el-step>
        <el-step title="å¡«å†™ä¿¡æ¯"></el-step>
        <el-step title="æ”¯ä»˜"></el-step>
      </el-steps>
    </div>
    <div class="ticket_query">


      <div class="app-container">

        <div class="divQuery">
          <div style="padding-top:10px;border-bottom:solid 2px #F3B1BE">
            <p style="font-family: SimHei,sans-serif;font-weight: bold;font-style: italic; font-size: 30px">
              &nbsp;&nbsp; æœºç¥¨æŸ¥è¯¢
            </p>
          </div>
        </div>


        <div style="display: flex;justify-content: space-evenly;" class="filter-container">
          <el-select style="width: 160px" v-model="fromCity" filterable placeholder="è¯·é€‰æ‹©å‡ºå‘åŸå¸‚">
            <el-option
                v-for="item in options_from"
                :key="item.value"
                :label="item.label"
                :value="item.value">
            </el-option>
          </el-select>

          <el-select style="width: 160px" v-model="toCity" filterable placeholder="è¯·é€‰æ‹©ç›®çš„åŸå¸‚">
            <el-option
                v-for="item in options_to"
                :key="item.value"
                :label="item.label"
                :value="item.value">
            </el-option>
          </el-select>
          <el-date-picker v-model="fromTime"
                          :clearable="false"
                          type="date"
                          value-format="yyyy-MM-dd"
                          placeholder="é€‰æ‹©å‡ºå‘æ—¶é—´"
                          style="width: 180px"
                          :picker-options="pickerOptions">
          </el-date-picker>
          <el-button @click="getQuery()" type="primary" class="dalfBut">æŸ¥è¯¢</el-button>
          <el-button @click="resetQueryForm()" type="primary" class="dalfBut">é‡ç½®æŸ¥è¯¢</el-button>
        </div>

        <div class="box">
          <el-table :default-sort="{prop: 'flightId', order: 'descending'}" empty-text="è¯·é€‰æ‹© å‡ºå‘/ç›®çš„åŸå¸‚å’Œæ—¥æœŸå“¦" size="15 px"
                    current-row-key="id" :data="dataList" stripe highlight-current-row :border="true">
            <el-table-column :resizable="true" type="index" align="center" label="åºå·"></el-table-column>
            <!--            <el-table-column prop="id" label="èˆªç­ID" align="center"></el-table-column>-->
            <!--            <el-table-column prop="airlineName" label="èˆªç©ºå…¬å¸" align="center"></el-table-column>-->
            <el-table-column sortable prop="flightId" label="èˆªç­å·" align="center"></el-table-column>
            <!--            <el-table-column width="80" prop="flightType" label="èˆªç­ç±»å‹" align="center"></el-table-column>-->
            <el-table-column width="80" prop="fromCity" label="å‡ºå‘åœ°" align="center"></el-table-column>
            <el-table-column width="80" prop="toCity" label="ç›®çš„åœ°" align="center"></el-table-column>
            <el-table-column sortable prop="fromTime" label="å‡ºå‘æ—¶é—´" align="center"></el-table-column>
            <el-table-column sortable prop="toTime" label="åˆ°è¾¾æ—¶é—´" align="center"></el-table-column>
            <el-table-column width="100" prop="classType" label="èˆ±å‹" align="center"></el-table-column>
            <el-table-column sortable prop="price" label="èˆ±å‹ä»·æ ¼" align="center"></el-table-column>
            <el-table-column width="90" prop="ticketRemain" label="èˆ±å‹ä½™ç¥¨" align="center"></el-table-column>
            <!--            <el-table-column prop="ticketTotal" label="èˆ±å‹æ€»ç¥¨" align="center"></el-table-column>-->
            <el-table-column prop="aircraftType" label="é£æœºå‹å·" align="center"></el-table-column>
            <el-table-column label="ä¹°ï¼" align="center">
              <template slot-scope="scope">
                <el-button :disabled="disabled" type="success" @click="handleOrder(scope.row)"
                >ç‚¹æˆ‘çƒ§é’±
                </el-button>
              </template>
            </el-table-column>
          </el-table>
        </div>
      </div>
    </div>
    <!--    main stuff ends here-->

    <!--    order popup starts here-->
    <div class="add-form">
      <el-dialog top="28vh" :modal="false" title="ç¡®è®¤èˆªç­" :visible.sync="dialogFormVisible4Order"
                 :close-on-click-modal="false" :show-close="false">
        <el-form ref="dataEditForm" :model="formData" :rules="rules" label-position="right" label-width="100px">
          <el-row>
            <el-col :span="7">
              <el-form-item label="èˆªç­å…¬å¸" prop="airlineName">
                <el-input :readonly="true" v-model="formData.airlineName"/>
              </el-form-item>
            </el-col>
            <el-col :span="7">
              <el-form-item label="èˆªç­å·" prop="flightId">
                <el-input :readonly="true" v-model="formData.flightId"/>
              </el-form-item>
            </el-col>
            <el-col :span="7">
              <el-form-item label="èˆ±å‹" prop="classType">
                <el-input :readonly="true" v-model="formData.classType"/>
              </el-form-item>
            </el-col>
          </el-row>
          <el-row>
            <el-col :span="7">
              <el-form-item label="å‡ºå‘åœ°" prop="fromCity">
                <el-input :readonly="true" v-model="formData.fromCity"/>
              </el-form-item>
            </el-col>
            <el-col :span="7">
              <el-form-item label="å‡ºå‘æ—¶é—´" prop="fromTime">
                <el-input :readonly="true" v-model="formData.fromTime"/>
              </el-form-item>
            </el-col>
            <el-col :span="7">
              <el-form-item label="èˆªç­ç±»å‹" prop="flightType">
                <el-input :readonly="true" v-model="formData.flightType"/>
              </el-form-item>
            </el-col>
          </el-row>
          <el-row>
            <el-col :span="7">
              <el-form-item label="ç›®çš„åœ°" prop="toCity">
                <el-input :readonly="true" v-model="formData.toCity"/>
              </el-form-item>
            </el-col>
            <el-col :span="7">
              <el-form-item label="åˆ°è¾¾æ—¶é—´" prop="toTime">
                <el-input :readonly="true" v-model="formData.toTime"/>
              </el-form-item>
            </el-col>
            <el-col :span="7">
              <el-form-item label="èˆ±å‹ä»·æ ¼" prop="price">
                <el-input :readonly="true" v-model="formData.price"/>
              </el-form-item>
            </el-col>
          </el-row>
          <el-row>
            <el-col :span="10">
              <el-form-item label="èˆ±å‹ä½™ç¥¨" prop="ticketRemain">
                <el-input :readonly="true" v-model="formData.ticketRemain"/>
              </el-form-item>
            </el-col>
            <el-col :span="10">
              <el-form-item label="é£æœºå‹å·" prop="aircraftType">
                <el-input :readonly="true" v-model="formData.aircraftType"/>
              </el-form-item>
            </el-col>
          </el-row>
        </el-form>
        <div slot="footer" class="dialog-footer">
          <el-button @click="cancel()">å–æ¶ˆ</el-button>
          <el-button type="primary" @click="handleOrderInfo()">ä¸‹ä¸€æ­¥</el-button>
        </div>
      </el-dialog>
    </div>
    <!--    order popup ends here-->

    <!--    info popup starts here-->
    <div class="add-form">
      <el-dialog :show-close="false" top="28vh" :modal="false" title="å¡«å†™ä¹˜æœºäººä¿¡æ¯" :visible.sync="dialogFormVisible4Info">
        <el-form ref="dataAddForm" :model="formOrderData" :rules="rules" label-position="right" label-width="100px">
          <el-row>
            <el-col :span="8">
              <el-form-item label="å§“å" prop="name">
                <el-input placeholder="è¯·ä¸ç™»æœºè¯ä»¶å§“åä¸€è‡´" clearable v-model="formOrderData.name"/>
              </el-form-item>
            </el-col>
            <el-col :span="8">
              <el-form-item label="èº«ä»½è¯å·" prop="citizenId">
                <el-input clearable v-model="formOrderData.citizenId"/>
              </el-form-item>
            </el-col>
            <el-col :span="8">
              <el-form-item label="æ‰‹æœºå·" prop="phone">
                <el-input clearable v-model="formOrderData.phone"/>
              </el-form-item>
            </el-col>
          </el-row>
        </el-form>
        <div slot="footer" class="dialog-footer">
          <el-button @click="cancel()">å–æ¶ˆ</el-button>
          <el-button type="primary" @click="handleTakeOrder()">ç¡®å®š</el-button>
        </div>
      </el-dialog>
    </div>
    <!--    info popup ends here-->

    <!--    error popup starts here-->
    <el-dialog
        title="æç¤º"
        :visible.sync="errorDialogVisible"
        width="30%"
        center>
      <span>è¯¥è¶Ÿèˆªç­å·²ç»æ²¡æœ‰ä½™ç¥¨äº†å“¦ï¼Œè¯·é€‰æ‹©å…¶ä»–èˆªç­ã€‚</span>
      <span slot="footer" class="dialog-footer">
        <el-button type="primary" @click="errorDialogVisible = false">ç¡® å®š</el-button>
      </span>
    </el-dialog>
    <!--    error popup ends here-->

    <!--    payment qrcode starts here-->
    <el-dialog
        :show-close="false"
        top="28vh"
        :modal="false"
        title="è”åˆä»˜æ¬¾"
        :visible.sync="paymentDialogVisible"
        width="30%"
        center>
      <span>æ‰«è¿™ä¸ªğŸä»˜æ¬¾</span>
      <div>
        <img src="/images/payment.png" alt="">
      </div>
      <span slot="footer" class="dialog-footer">
        <el-button type="primary" @click="handlepay()">ç¡® å®š</el-button>
      </span>
    </el-dialog>
    <!--    payment qrcode ends here-->

  </div>
  <div class="footer">
    <div class="footer_bd">
      <a href="http://www.staralliance.com/cn/" target="_blank">
        <span class="star_logo"></span>
      </a>
      <div class="ft_in">
        <p>
          <a href="#" target="_blank">æ³•å¾‹å£°æ˜</a>
          <span id="separator">|</span>
          <a href="#" target="_blank">è”ç³»æˆ‘ä»¬</a>
          <span id="separator">|</span>
          <a href="#" target="_blank">ä½¿ç”¨æ¡æ¬¾</a>
          <span id="separator">|</span>
          <a href="#" target="_blank">éšç§é€šçŸ¥</a>
          <span id="separator">|</span>
          <a href="#" target="_blank">Cookieå£°æ˜</a>
          <span id="separator">|</span>
          <a href="#" target="_blank">ç‰ˆæƒä¿¡æ¯</a>
          <span id="separator">|</span>
          <a href="#" target="_blank">è¥ä¸šæ‰§ç…§</a>
          <span id="separator">|</span>
          <a href="#" target="_blank">æ˜Ÿç›Ÿä¼šå±•</a>
          <span id="separator">|</span>
          <a href="#" target="_blank">äººåŠ›èµ„æº</a>
          <span id="separator">|</span>
        </p>
        <p class="copyright">
          <a href="http://beian.miit.gov.cn/" target="_blank">ç²¤ICPå¤‡08115151å·</a>
          &nbsp;&nbsp;&nbsp;&nbsp;Copyrightâ—2022&nbsp;&nbsp;&nbsp;&nbsp;SHENZHEN AIRLINES. All Rights
          Reserved
        </p>
      </div>
    </div>
  </div>

</div>

<script src="/js/vue.js"></script>
<script src="../../plugins/elementui/index.js"></script>
<script type="text/javascript" src="/js/jquery.min.js"></script>
<script src="/js/axios-0.18.0.js"></script>

<script>

  // row info
  let row_id;

  //uuid
  let uuid;

  //dateformat
  let date = new Date().toLocaleDateString('zh-CN').split('/');
  if (date[1].length === 1) {
    date[1] = '0' + date[1];
  }
  if (date[2].length === 1) {
    date[2] = '0' + date[2];
  }
  let newDate = date[0] + '-' + date[1] + '-' + date[2]

  let vue = new Vue({
    el: "#app",
    data: {
      dataList: [],//å½“å‰é¡µè¦å±•ç¤ºçš„åˆ—è¡¨æ•°æ®
      dataListOrder: [],//å½“å‰é¡µè¦å±•ç¤ºçš„åˆ—è¡¨æ•°æ®
      dialogFormVisible4Order: false,//è®¢å•è¡¨å•æ˜¯å¦å¯è§
      dialogFormVisible4Info: false,//è®¢å•è¡¨å•æ˜¯å¦å¯è§
      errorDialogVisible: false,//é”™è¯¯æç¤ºæ˜¯å¦å¯è§
      paymentDialogVisible: false,
      formData: {},//è¡¨å•æ•°æ®
      formOrderData: {},//è¡¨å•æ•°æ®
      formAlterData: {},//è¡¨å•æ•°æ®
      rules: {//æ ¡éªŒè§„åˆ™
        name: [{required: true, message: 'è¯¥é¡¹ä¸ºå¿…å¡«é¡¹', trigger: 'blur'}],
        citizenId: [{required: true, message: 'è¯¥é¡¹ä¸ºå¿…å¡«é¡¹', trigger: 'blur'}],
        phone: [{required: true, message: 'è¯¥é¡¹ä¸ºå¿…å¡«é¡¹', trigger: 'blur'}],
      },

      // filter
      id: "", //èˆªç­id
      fromCity: "", //å‡ºå‘åœ°
      fromTime: newDate, //å‡ºå‘æ—¶é—´
      toCity: "", //ç›®çš„åœ°

      disabled: false,
      // datepicker
      pickerOptions: {
        disabledDate(time) {
          return time.getTime() + 1000 * 60 * 60 * 24 < Date.now();
        },
      },

      //city options
      options_from: [{
        value: 'åŒ—äº¬',
        label: 'åŒ—äº¬'
      }, {
        value: 'ä¸Šæµ·',
        label: 'ä¸Šæµ·'
      }, {
        value: 'å¹¿å·',
        label: 'å¹¿å·'
      }, {
        value: 'æ­å·',
        label: 'æ­å·'
      }, {
        value: 'æ·±åœ³',
        label: 'æ·±åœ³'
      }, {
        value: 'çƒŸå°',
        label: 'çƒŸå°'
      }, {
        value: 'æµå—',
        label: 'æµå—'
      }, {
        value: 'æˆéƒ½',
        label: 'æˆéƒ½'
      }, {
        value: 'é’å²›',
        label: 'é’å²›'
      }, {
        value: 'å¤§è¿',
        label: 'å¤§è¿'
      }, {
        value: 'å¤©æ´¥',
        label: 'å¤©æ´¥'
      }, {
        value: 'éƒ‘å·',
        label: 'éƒ‘å·'
      }, {
        value: 'å“ˆå°”æ»¨',
        label: 'å“ˆå°”æ»¨'
      }, {
        value: 'æ²ˆé˜³',
        label: 'æ²ˆé˜³'
      }, {
        value: 'å¦é—¨',
        label: 'å¦é—¨'
      }, {
        value: 'è¥¿å®‰',
        label: 'è¥¿å®‰'
      }, {
        value: 'é•¿æ˜¥',
        label: 'é•¿æ˜¥'
      }, {
        value: 'ç¦å·',
        label: 'ç¦å·'
      }, {
        value: 'å—äº¬',
        label: 'å—äº¬'
      }, {
        value: 'é‡åº†',
        label: 'é‡åº†'
      }, {
        value: 'ä¹Œé²æœ¨é½',
        label: 'ä¹Œé²æœ¨é½'
      }, {
        value: 'æµ·å£',
        label: 'æµ·å£'
      }, {
        value: 'å—æ˜Œ',
        label: 'å—æ˜Œ'
      }, {
        value: 'æ­¦æ±‰',
        label: 'æ­¦æ±‰'
      }, {
        value: 'é•¿æ²™',
        label: 'é•¿æ²™'
      }, {
        value: 'æ¡‚æ—',
        label: 'æ¡‚æ—'
      }, {
        value: 'æ˜†æ˜',
        label: 'æ˜†æ˜'
      }, {
        value: 'å®æ³¢',
        label: 'å®æ³¢'
      }, {
        value: 'ç æµ·',
        label: 'ç æµ·'
      }],
      fromCity: '',

      options_to: [{
        value: 'åŒ—äº¬',
        label: 'åŒ—äº¬'
      }, {
        value: 'ä¸Šæµ·',
        label: 'ä¸Šæµ·'
      }, {
        value: 'å¹¿å·',
        label: 'å¹¿å·'
      }, {
        value: 'æ­å·',
        label: 'æ­å·'
      }, {
        value: 'æ·±åœ³',
        label: 'æ·±åœ³'
      }, {
        value: 'çƒŸå°',
        label: 'çƒŸå°'
      }, {
        value: 'æµå—',
        label: 'æµå—'
      }, {
        value: 'æˆéƒ½',
        label: 'æˆéƒ½'
      }, {
        value: 'é’å²›',
        label: 'é’å²›'
      }, {
        value: 'å¤§è¿',
        label: 'å¤§è¿'
      }, {
        value: 'å¤©æ´¥',
        label: 'å¤©æ´¥'
      }, {
        value: 'éƒ‘å·',
        label: 'éƒ‘å·'
      }, {
        value: 'å“ˆå°”æ»¨',
        label: 'å“ˆå°”æ»¨'
      }, {
        value: 'æ²ˆé˜³',
        label: 'æ²ˆé˜³'
      }, {
        value: 'å¦é—¨',
        label: 'å¦é—¨'
      }, {
        value: 'è¥¿å®‰',
        label: 'è¥¿å®‰'
      }, {
        value: 'é•¿æ˜¥',
        label: 'é•¿æ˜¥'
      }, {
        value: 'ç¦å·',
        label: 'ç¦å·'
      }, {
        value: 'å—äº¬',
        label: 'å—äº¬'
      }, {
        value: 'é‡åº†',
        label: 'é‡åº†'
      }, {
        value: 'ä¹Œé²æœ¨é½',
        label: 'ä¹Œé²æœ¨é½'
      }, {
        value: 'æµ·å£',
        label: 'æµ·å£'
      }, {
        value: 'å—æ˜Œ',
        label: 'å—æ˜Œ'
      }, {
        value: 'æ­¦æ±‰',
        label: 'æ­¦æ±‰'
      }, {
        value: 'é•¿æ²™',
        label: 'é•¿æ²™'
      }, {
        value: 'æ¡‚æ—',
        label: 'æ¡‚æ—'
      }, {
        value: 'æ˜†æ˜',
        label: 'æ˜†æ˜'
      }, {
        value: 'å®æ³¢',
        label: 'å®æ³¢'
      }, {
        value: 'ç æµ·',
        label: 'ç æµ·'
      }],
      toCity: '',

      //
      activeIndex: '3',
      activeStep: 1,
    },
    //é’©å­å‡½æ•°ï¼ŒVUEå¯¹è±¡åˆå§‹åŒ–å®Œæˆåè‡ªåŠ¨æ‰§è¡Œ
    created() {
      this.getQuery();
    },

    methods: {
      //å¯¼èˆªæ 
      handleSelect(key) {
        key = parseInt(key);
        switch (key) {
          default:
            break;
          case 1:
            window.location.href = "/toUEdit";
            break;
          case 2:
            window.location.href = "/";
            break;
          case 3:
            window.location.href = "/toSearch";
            break;
          case 4:
            window.location.href = "/toOrder";
            break;
          case 5:
            window.location.replace("/logout");
            break;
        }
      },
      getAll() {
        axios.get("/flights").then((res) => {
          this.dataList = res.data.data;
        });
      },

      //å–æ¶ˆ
      cancel() {
        this.activeStep = 1;
        this.dialogFormVisible4Order = false;
        this.dialogFormVisible4Info = false;
        this.$message.info("å½“å‰æ“ä½œå–æ¶ˆ");
      },

      resetQueryForm() {
        this.fromCity = "";
        this.toCity = "";
        this.fromTime = newDate;

        this.getQuery();
      },

      getQuery() {
        qurl = "?fromCity=" + this.fromCity;
        qurl += "&toCity=" + this.toCity;
        qurl += "&fromTime=" + this.fromTime;

        axios.get("/flights/q/" + qurl).then((res) => {
          this.dataList = res.data.data;
        });
      },


      handleOrder(row) {
        row_id = row.id;
        uuid = row.uuid;
        if (row.ticketRemain > 0) {
          axios.get("/flights/" + row.id).then((res) => {
            if (res.data.flag && res.data.data != null) {
              this.activeStep = 2;
              this.dialogFormVisible4Order = true;
              this.formData = res.data.data;
            } else {
              this.activeStep = 1;
              this.$message.error("å°šæœªç™»å½•ï¼Œè¯·å…ˆç™»å½•")
            }
          }).finally(() => {
            this.getQuery();
          });
        } else {
          this.errorDialogVisible = true;
        }
      },

      handleOrderInfo() {
        this.dialogFormVisible4Order = false;
        axios.get("/flights/" + row_id).then((res) => {
          if (res.data.flag && res.data.data != null) {
            this.activeStep = 3;
            this.dialogFormVisible4Info = true;
            this.formData = res.data.data;
            this.formOrderData = this.formData;
            console.log(this.formOrderData)
          } else {
            this.activeStep = 1;
            this.$message.error("æ•°æ®åŒæ­¥å¤±è´¥ï¼Œè‡ªåŠ¨åˆ·æ–°")
          }
        }).finally(() => {
          this.getQuery();
        });
      },

      handleTakeOrder() {
        axios.get("/flights/" + row_id).then((res) => {
          if (res.data.flag && res.data.data != null) {
            this.formAlterData = res.data.data;
            axios.put("/flights/to/", this.formAlterData);
          } else {
            this.$message.error("æ•°æ®åŒæ­¥å¤±è´¥ï¼Œè‡ªåŠ¨åˆ·æ–°");
          }
        }).finally(() => {
          axios.post("/orders", this.formOrderData).then((res) => {
            if (res.data.flag) {
              this.dialogFormVisible4Info = false;
              this.$message.success(res.data.msg);
            } else {
              this.$message.error(res.data.msg);
            }
          }).finally(()=>{
            this.activeStep = 4;
            this.paymentDialogVisible = true;
          });
        });
      },

      handlepay(){
        // here needs actual payment token
        // the aim of this system is the ticketing not paying...
        // hence, you can click the button, and it will pay successfully.
        // if you need to deploy this system, plz complete the payment function.
        axios.put("/orders/pay/").then((res)=>{
          if (res.data.flag) {
            this.paymentDialogVisible = false;
            this.$message.success(res.data.msg);
          } else {
            this.$message.error(res.data.msg);
          }
        })
        this.activeStep = 1;
      }

    }
  })
</script>

<script>

</script>

</body>

</html>
